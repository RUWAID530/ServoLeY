generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admin_actions {
  id        String   @id
  adminId   String
  action    String
  targetId  String
  details   Json?
  createdAt DateTime @default(now())
  users     users    @relation(fields: [adminId], references: [id])
}

model call_logs {
  id            String        @id
  callSessionId String
  status        String
  duration      Int?
  timestamp     DateTime      @default(now())
  call_sessions call_sessions @relation(fields: [callSessionId], references: [id], onDelete: Cascade)
}

model call_sessions {
  id                                    String      @id
  customerId                            String
  providerId                            String
  orderId                               String?
  twilioCallSid                         String?
  customerPhone                         String
  providerPhone                         String
  status                                String      @default("INITIATED")
  duration                              Int?
  startedAt                             DateTime?
  endedAt                               DateTime?
  createdAt                             DateTime    @default(now())
  updatedAt                             DateTime
  call_logs                             call_logs[]
  users_call_sessions_customerIdTousers users       @relation("call_sessions_customerIdTousers", fields: [customerId], references: [id])
  orders                                orders?     @relation(fields: [orderId], references: [id])
  users_call_sessions_providerIdTousers users       @relation("call_sessions_providerIdTousers", fields: [providerId], references: [id])
}

model faqs {
  id        String   @id
  question  String
  answer    String
  category  String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model messages {
  id                               String   @id
  senderId                         String
  receiverId                       String
  content                          String
  orderId                          String?
  createdAt                        DateTime @default(now())
  users_messages_receiverIdTousers users    @relation("messages_receiverIdTousers", fields: [receiverId], references: [id])
  users_messages_senderIdTousers   users    @relation("messages_senderIdTousers", fields: [senderId], references: [id])
}

model notification_preferences {
  id           String   @id
  userId       String   @unique
  pushEnabled  Boolean  @default(true)
  emailEnabled Boolean  @default(true)
  smsEnabled   Boolean  @default(true)
  orderUpdates Boolean  @default(true)
  messages     Boolean  @default(true)
  promotions   Boolean  @default(false)
  systemAlerts Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model notification_tokens {
  id        String   @id
  userId    String
  token     String   @unique
  platform  String?
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model notifications {
  id        String    @id
  userId    String
  title     String
  body      String
  data      Json?
  type      String
  status    String    @default("SENT")
  readAt    DateTime?
  createdAt DateTime  @default(now())
  users     users     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model orders {
  id                             String               @id
  customerId                     String
  providerId                     String
  serviceId                      String
  status                         OrderStatus          @default(PENDING)
  totalAmount                    Float
  commission                     Float                @default(0)
  serviceDate                    DateTime
  address                        String
  notes                          String?
  cancelledBy                    String?
  cancelReason                   String?
  cancelledAt                    DateTime?
  completedAt                    DateTime?
  createdAt                      DateTime             @default(now())
  updatedAt                      DateTime
  call_sessions                  call_sessions[]
  users_orders_customerIdTousers users                @relation("orders_customerIdTousers", fields: [customerId], references: [id])
  users_orders_providerIdTousers users                @relation("orders_providerIdTousers", fields: [providerId], references: [id])
  services                       services             @relation(fields: [serviceId], references: [id])
  reviews                        reviews?
  virtual_assignments            virtual_assignments?
}

model otps {
  id        String   @id
  userId    String
  code      String
  type      String
  isUsed    Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model payment_orders {
  id            String   @id
  userId        String
  orderId       String   @unique
  paymentId     String?
  amount        Float
  currency      String   @default("INR")
  paymentMethod String
  status        String   @default("PENDING")
  type          String
  signature     String?
  metadata      Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  users         users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model profiles {
  id             String   @id
  userId         String   @unique
  firstName      String
  lastName       String
  avatar         String?
  address        String?
  pincode        String?
  city           String?
  state          String?
  country        String   @default("India")
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  passwordHash   String?
  googleId       String?
  googleVerified Boolean  @default(false)
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model provider_locations {
  id         String    @id
  providerId String
  lat        Float
  lng        Float
  address    String?
  zoneId     String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  providers  providers @relation(fields: [providerId], references: [id], onDelete: Cascade)
  zones      zones?    @relation(fields: [zoneId], references: [id])

  @@index([lat, lng])
  @@index([providerId])
  @@index([zoneId])
}

model providers {
  id                 String               @id
  userId             String               @unique
  businessName       String
  providerType       ProviderType
  category           String
  area               String
  address            String
  panNumber          String
  aadhaarNumber      String
  gstNumber          String?
  bankAccount        String?
  upiId              String?
  isVerified         Boolean              @default(false)
  isActive           Boolean              @default(true)
  rating             Float                @default(0)
  totalOrders        Int                  @default(0)
  isOnline           Boolean              @default(false)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  provider_locations provider_locations[]
  users              users                @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviews            reviews[]
  services           services[]
}

model report_schedules {
  id         String   @id
  adminId    String
  reportType String
  frequency  String
  email      String
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  users      users    @relation(fields: [adminId], references: [id])
}

model reviews {
  id                              String     @id
  orderId                         String     @unique
  reviewerId                      String
  revieweeId                      String
  providerId                      String?
  rating                          Int
  comment                         String?
  createdAt                       DateTime   @default(now())
  orders                          orders     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  providers                       providers? @relation(fields: [providerId], references: [id])
  users_reviews_revieweeIdTousers users      @relation("reviews_revieweeIdTousers", fields: [revieweeId], references: [id])
  users_reviews_reviewerIdTousers users      @relation("reviews_reviewerIdTousers", fields: [reviewerId], references: [id])
}

model services {
  id              String    @id
  providerId      String
  name            String
  description     String
  category        String
  price           Float
  basePrice       Float?
  offerPercent    Int?      @default(0)
  estimatedTime   Int?
  warrantyMonths  Int?
  duration        Int
  status          String    @default("ACTIVE")
  isActive        Boolean   @default(true)
  rejectionReason String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  orders          orders[]
  providers       providers @relation(fields: [providerId], references: [id], onDelete: Cascade)
}

model tickets {
  id          String   @id
  userId      String
  subject     String
  description String
  status      String   @default("OPEN")
  priority    String   @default("MEDIUM")
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [userId], references: [id])
}

model transactions {
  id            String          @id
  walletId      String
  amount        Float
  type          TransactionType
  description   String
  paymentMethod PaymentMethod?
  orderId       String?
  createdAt     DateTime        @default(now())
  wallets       wallets         @relation(fields: [walletId], references: [id], onDelete: Cascade)
}

model user_payment_methods {
  id          String   @id
  userId      String
  type        String
  provider    String?
  upiId       String?
  cardNumber  String?
  cardName    String?
  expiryMonth String?
  expiryYear  String?
  last4       String?
  isDefault   Boolean  @default(false)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_verifications {
  id                 String    @id
  userId             String    @unique
  idType             String
  idNumber           String
  idFrontImage       String
  idBackImage        String?
  addressProofType   String
  addressProofNumber String
  addressProofImage  String
  verificationStatus String    @default("pending")
  verifiedAt         DateTime?
  verifiedBy         String?
  rejectionReason    String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  users              users     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model users {
  id                                            String                    @id
  email                                         String?                   @unique
  phone                                         String?                   @unique
  userType                                      UserType
  isVerified                                    Boolean                   @default(false)
  isActive                                      Boolean                   @default(true)
  isBlocked                                     Boolean                   @default(false)
  createdAt                                     DateTime                  @default(now())
  updatedAt                                     DateTime
  cancellationsCount                            Int                       @default(0)
  isSuspect                                     Boolean                   @default(false)
  admin_actions                                 admin_actions[]
  call_sessions_call_sessions_customerIdTousers call_sessions[]           @relation("call_sessions_customerIdTousers")
  call_sessions_call_sessions_providerIdTousers call_sessions[]           @relation("call_sessions_providerIdTousers")
  messages_messages_receiverIdTousers           messages[]                @relation("messages_receiverIdTousers")
  messages_messages_senderIdTousers             messages[]                @relation("messages_senderIdTousers")
  notification_preferences                      notification_preferences?
  notification_tokens                           notification_tokens[]
  notifications                                 notifications[]
  orders_orders_customerIdTousers               orders[]                  @relation("orders_customerIdTousers")
  orders_orders_providerIdTousers               orders[]                  @relation("orders_providerIdTousers")
  otps                                          otps[]
  payment_orders                                payment_orders[]
  profiles                                      profiles?
  providers                                     providers?
  report_schedules                              report_schedules[]
  reviews_reviews_revieweeIdTousers             reviews[]                 @relation("reviews_revieweeIdTousers")
  reviews_reviews_reviewerIdTousers             reviews[]                 @relation("reviews_reviewerIdTousers")
  tickets                                       tickets[]
  user_payment_methods                          user_payment_methods[]
  user_verifications                            user_verifications?
  wallets                                       wallets?
}

model virtual_assignments {
  id              String          @id
  orderId         String          @unique
  virtualNumberId String
  status          String          @default("ASSIGNED")
  assignedAt      DateTime        @default(now())
  releasedAt      DateTime?
  orders          orders          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  virtual_numbers virtual_numbers @relation(fields: [virtualNumberId], references: [id], onDelete: Cascade)
}

model virtual_numbers {
  id                  String                @id
  phoneNumber         String                @unique
  isAssigned          Boolean               @default(false)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  virtual_assignments virtual_assignments[]
}

model wallets {
  id           String         @id
  userId       String         @unique
  balance      Float          @default(0)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  transactions transactions[]
  users        users          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model zones {
  id                 String               @id
  name               String               @unique
  city               String
  polygon            Json
  isActive           Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  provider_locations provider_locations[]

  @@index([isActive])
}

enum OrderStatus {
  PENDING
  ACCEPTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REJECTED
}

enum PaymentMethod {
  UPI
  CARD
  NET_BANKING
  WALLET
}

enum ProviderType {
  FREELANCER
  STORE
}

enum TransactionType {
  CREDIT
  DEBIT
  REFUND
  COMMISSION
  WITHDRAWAL
}

enum UserType {
  CUSTOMER
  PROVIDER
  ADMIN
}
